!function n(a,o,u){function c(e,t){if(!o[e]){if(!a[e]){var s="function"==typeof require&&require;if(!t&&s)return s(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var r=o[e]={exports:{}};a[e][0].call(r.exports,function(t){return c(a[e][1][t]||t)},r,r.exports,n,a,o,u)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,s){var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{staticClass:"arrow",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M99.53,52.45a6.26,6.26,0,0,0-1.35-6.8L54.49,2a6.24,6.24,0,0,0-8.83,8.83l33,33H6.39a6.24,6.24,0,1,0,0,12.48H78.7l-33,33a6.24,6.24,0,1,0,8.83,8.83L98.18,54.49A6.23,6.23,0,0,0,99.53,52.45Z"}})])},i.staticRenderFns=[]},{}],2:[function(t,e,s){var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[s("path",{attrs:{fill:"#f8f8f8",d:"M88.76,25.43V92.34A7.66,7.66,0,0,1,81.09,100H18.91a7.66,7.66,0,0,1-7.66-7.66V7.66A7.66,7.66,0,0,1,18.91,0h45Z"}}),t._v(" "),s("path",{attrs:{fill:"#c1c1c1",d:"M88.76,25.43H71.58a7.66,7.66,0,0,1-7.66-7.66V0ZM68.63,62.29h0v.26a7.13,7.13,0,1,1-3.7-6.25V40.21L42.22,44.29V76h0a7.13,7.13,0,1,1-3.7-6.51V42.75A1.85,1.85,0,0,1,40,40.93l26.41-4.75.33,0A1.85,1.85,0,0,1,68.63,38Z"}})])},i.staticRenderFns=[]},{}],3:[function(t,e,s){var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M98.35,22.5a5.5,5.5,0,0,0,0-7.86l-13-13a5.5,5.5,0,0,0-7.86,0L66.64,12.57,87.43,33.36ZM0,79.21V100H20.79L80,40.83,59.17,20Z"}})])},i.staticRenderFns=[]},{}],4:[function(t,e,s){var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M67.17,6a6,6,0,0,1,6-6H87a6,6,0,0,1,6,6V94a6,6,0,0,1-6,6H73.17a6,6,0,0,1-6-6ZM7,94a6,6,0,0,0,6,6H26.83a6,6,0,0,0,6-6V6a6,6,0,0,0-6-6H13A6,6,0,0,0,7,6Z"}})])},i.staticRenderFns=[]},{}],5:[function(t,e,s){var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M87.73,42,21.46,1.42A9,9,0,0,0,7.83,9.48V90.63c0,7.31,7.66,11.72,13.63,8.05L87.73,58.12a9.53,9.53,0,0,0,0-16.11"}})])},i.staticRenderFns=[]},{}],6:[function(a,t,o){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=n(a(2)),e=n(a(5)),s=n(a(4)),i=n(a(3)),r=n(a(1));function n(t){return t&&t.__esModule?t:{default:t}}o.default={components:{AudioFile:t.default,PlayIcon:e.default,PauseIcon:s.default,EditIcon:i.default,ArrowIcon:r.default},data:function(){return{src:{id:"",type:"",url:""},resize:{isResizing:!1,handle:String,index:Number,max:Number,min:Number},loaded:!1,isPlaying:!1,active:null,subs:[],coords:{time:0,prop:0,text:""},currentTime:{time:0,prop:0,text:""},duration:{time:0,text:""},start:{time:0,prop:0,text:""},end:{time:0,prop:0,text:""}}},props:{storage:Object,theme:String,file:String,debug:Boolean,timelines:Object},computed:{isAudio:function(){return"audio"==this.src.type},isVideo:function(){return"video"==this.src.type},currentPlayer:function(){return this.isAudio?this.$refs.audioPlayer:this.$refs.videoPlayer},activeTimeline:function(){return null!=this.active},activeColor:function(){return!!this.activeTimeline&&this.active.color},fileExists:function(){return this.src.url&&this.src.type},startExists:function(){return 0<this.start.time},endExists:function(){return 0<this.end.time},disableStart:function(){return!this.startExists&&this.isOverlapping},disableEnd:function(){return this.isBeforeStart||this.isAfterNextSub||this.startIsOverlapping},isOverlapping:function(){var t=!1,e=!0,s=!1,i=void 0;try{for(var r,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;if(this.currentTime.prop>=a.startprop&&this.currentTime.prop<=a.endprop){t=!0;break}}}catch(t){s=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(s)throw i}}return t},startIsOverlapping:function(){var t=!1,e=!0,s=!1,i=void 0;try{for(var r,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;if(this.start.prop>=a.startprop&&this.start.prop<=a.endprop){t=!0;break}}}catch(t){s=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(s)throw i}}return t},isBeforeStart:function(){return this.currentTime.time<=this.start.time},isAfterNextSub:function(){var t=this.getNextSub(this.start.prop);return!!t&&this.currentTime.prop>=t.startprop},id:function(){return this.$store.state.form.current},pageValues:function(){return this.$store.getters["form/values"](this.id)}},watch:{pageValues:{immediate:!0,handler:function(){this.updateValues()}}},created:function(){var e=this;this.load().then(function(t){e.theme=t.theme,e.debug=t.debug,e.storage=t.storage,e.timelines=t.timelines,e.storage=t.storage,e.lang=t.lang,t.file&&(e.src.url=t.file.url,e.src.type=t.file.type)}),document.addEventListener("mouseup",this.stopResizing)},destroyed:function(){document.removeEventListener("mouseup",this.stopResizing)},methods:{init:function(){this.currentPlayer.addEventListener("timeupdate",this.timeUpdate),this.currentPlayer.addEventListener("loadeddata",this.loadedData),this.loaded=!0},loadedData:function(){2<=this.currentPlayer.readyState&&(this.setDuration(),this.syncCurrentTime(0))},timeUpdate:function(t){var e=this.currentPlayer.currentTime;!this.loaded&&0<e&&(this.loaded=!0),this.syncCurrentTime(e),e==this.duration.time&&this.isPlaying&&this.playPause()},playPause:function(){var t=this.currentPlayer;0==this.duration.time&&this.setDuration(),this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},updateCoords:function(t){var e=this.$refs.timeline;if(!e)return!1;var s=e.getBoundingClientRect(),i=e.clientWidth,r=(t.clientX-s.left)/i;r=Math.max(0,Math.min(1,r.toFixed(4))),this.coords.prop=r,this.coords.time=r*this.duration.time,this.coords.text=this.formatTime(this.coords.time),this.resize.isResizing&&this.resizeSub(t)},initResize:function(t,e){if(!this.active)return!1;if(this.resize.index=this.subs.indexOf(t),this.resize.isResizing=!0,"left"==(this.resize.handle=e)){var s=this.getPrevSub(parseFloat(t.startprop));this.resize.min=s?parseFloat(s.endprop)+1e-4:0,this.resize.max=parseFloat(t.endprop)-1e-4}else if("right"==e){var i=this.getNextSub(parseFloat(t.startprop));this.resize.min=parseFloat(t.startprop)+1e-4,this.resize.max=i?parseFloat(i.startprop)-1e-4:1}},resizeSub:function(t){var e=this.subs[this.resize.index];if("left"==this.resize.handle){var s=Math.min(this.resize.max,Math.max(this.resize.min,this.coords.prop));e.startprop=s,e.start=s*this.duration.time}if("right"==this.resize.handle){var i=Math.min(this.resize.max,Math.max(this.resize.min,this.coords.prop));e.endprop=i,e.end=i*this.duration.time}},stopResizing:function(t){if(!this.resize.isResizing)return!1;this.updateStructure(),this.resize.isResizing=!1,this.resize.handle=String,this.resize.index=Number,this.resize.max=Number,this.resize.min=Number},onHandleMouseDown:function(t){document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp)},onDocumentMouseUp:function(t){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove),this.syncProgress(t)},onDocumentMouseMove:function(t){this.syncProgress(t)},syncProgress:function(t){this.currentTime.prop=this.coords.prop.toFixed(4),this.currentTime.time=this.coords.prop*this.duration.time,this.currentTime.text=this.formatTime(this.coords.time),this.currentPlayer.currentTime=this.currentTime.time},setStart:function(){this.startExists?(this.resetStart(),this.resetEnd()):(this.start.prop=this.currentTime.prop,this.start.text=this.currentTime.text,this.start.time=this.currentTime.time)},setEnd:function(){this.end.prop=this.currentTime.prop,this.end.text=this.currentTime.text,this.end.time=this.currentTime.time;var t={start:this.start.time,startprop:this.start.prop,end:this.end.time,endprop:this.end.prop,timeline:this.active.id},e=this.getNewIndex();this.subs.splice(e,0,t),this.updateStructure(),this.resetStart(),this.resetEnd()},getNextSub:function(e){return this.timelineSubs(this.active).find(function(t){return t.startprop>e})},getPrevSub:function(e){return this.timelineSubs(this.active).splice(0).reverse().find(function(t){return e>t.endprop})},getNewIndex:function(){var e=this;if(!this.subs.length)return 0;if(this.timelineSubs(this.active).length){var t=this.getNextSub(this.start.prop);if(t)return this.subs.indexOf(t);var s=this.getPrevSub(this.start.prop);return this.subs.indexOf(s)+1}if(0==this.timelines.indexOf(this.active))return 0;var i=this.timelines.slice(this.timelines.indexOf(this.active)+1);if(i){var r=i.filter(function(t){return e.timelineSubs(t).length});if(r.length){var n=r[0],a=this.timelineSubs(n)[0];return this.subs.indexOf(a)}return this.subs.length}return this.subs.length},resetStart:function(){this.start.prop=0,this.start.text=0,this.start.time=0},resetEnd:function(){this.end.prop=0,this.end.text=0,this.end.time=0},setDuration:function(){var t=this.currentPlayer;this.duration.time=t.duration,this.duration.text=this.formatTime(t.duration)},syncCurrentTime:function(t){this.currentTime.time=t,this.currentTime.prop=(t/this.duration.time).toFixed(4),this.currentTime.text=this.formatTime(t)},setActive:function(t){this.active==t?(this.active=null,this.resetStart(),this.resetEnd()):this.active=t},timelineSubs:function(e){return this.subs.filter(function(t){return t.timeline==e.id})},formatTime:function(t){var e=Math.floor(t);return(e-(e%=60))/60+(9<e?"'":"'0")+e},updateValues:function(){for(var t in this.pageValues)if(Object.values(this.storage).includes(t)){var e=this.pageValues[t];this.setValue(t,e)}},setValue:function(t,e){var s=this;try{for(var i in this.storage)if(this.storage[i]===t)switch(i){case"src":this.loaded=!1,Array.isArray(e)&&e.length?this.src={id:e[0].id,url:e[0].url,type:e[0].type}:this.src={id:"",url:"",type:""};break;case"subs":if(!Array.isArray(e)){console.warn("could not adapt field to markers datapoint, not an array: ",e);break}this.subs=e;break;default:this[i]=e}this.src.type&&!this.loaded&&this.$nextTick(function(){s.init()})}catch(t){console.warn(t)}},updateStructure:function(){this.storage.subs&&this.$store.dispatch("form/update",[this.id,this.storage.subs,this.subs])},isObject:function(t){return t===Object(t)},label:function(t){return this.isObject(t.label)?t.label[this.lang]:t.label}}}}(),t.exports.__esModule&&(t.exports=t.exports.default);var e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var s=this,t=s.$createElement,i=s._self._c||t;return i("div",{staticClass:"subtitler",attrs:{"data-theme":s.theme,"data-color":s.activeColor},on:{mousemove:s.updateCoords}},[i("div",{staticClass:"subtitler-background"}),s._v(" "),s.fileExists?s._e():i("div",{staticClass:"subtitler-placeholder"},[i("div",{staticClass:"subtitler-placeholder-ctn"},[s._v("\n\t\t\tPlease select a file\n\t\t")])]),s._v(" "),s.debug&&s.fileExists?i("div",{staticClass:"subtitler-toolbar"},[i("div",{staticClass:"subtitler-toolbar-debug"},[i("div",{staticClass:"coord prop"},[s._v(s._s(s.coords.prop))]),s._v(" "),i("div",{staticClass:"coord time"},[s._v(s._s(s.coords.time))]),s._v(" "),i("div",{staticClass:"coord text"},[s._v(s._s(s.coords.text))])])]):s._e(),s._v(" "),s.fileExists?i("div",{class:["subtitler-file",{debug:s.debug}]},[s.isVideo?i("div",{staticClass:"subtitler-video"},[i("div",{staticClass:"subtitler-video-ctn"},[i("video",{ref:"videoPlayer"},[i("source",{attrs:{src:s.src.url}})])])]):s._e(),s._v(" "),s.isAudio?i("div",{staticClass:"subtitler-audio"},[i("div",{staticClass:"audio-icon"},[i("audio-file")],1),s._v(" "),i("audio",{ref:"audioPlayer"},[i("source",{attrs:{src:s.src.url}})])]):s._e()]):s._e(),s._v(" "),s.fileExists?i("div",{staticClass:"subtitler-editor"},[i("div",{staticClass:"subtitler-editor-firstline"},[i("div",{staticClass:"left"},[i("button",{staticClass:"play",on:{click:s.playPause}},[s.isPlaying?s._e():i("play-icon"),s._v(" "),s.isPlaying?i("pause-icon"):s._e()],1),s._v(" "),s.activeTimeline?i("div",{staticClass:"range-buttons"},[i("button",{class:["range-button start",{disabled:s.disableStart},{active:s.startExists}],on:{click:s.setStart}},[s._v("{")]),s._v(" "),s.startExists?i("arrow-icon"):s._e(),s._v(" "),s.startExists?i("button",{staticClass:"range-button end",class:["range-button end",{disabled:s.disableEnd}],on:{click:s.setEnd}},[s._v("}")]):s._e()],1):s._e()]),s._v(" "),i("div",{ref:"timeline",staticClass:"right"},[i("div",{staticClass:"duration"},[s._v(s._s(s.duration.text))])])]),s._v(" "),i("div",{staticClass:"subtitler-editor-timelines"},s._l(s.timelines,function(e,t){return i("div",{class:["timeline",{active:e==s.active},{inactive:s.activeTimeline&&e!=s.active}],attrs:{"data-theme":e.color}},[i("div",{staticClass:"left"},[i("div",{staticClass:"tick-wrapper"},[i("div",{staticClass:"tick",on:{click:function(t){s.setActive(e)}}},[i("edit-icon")],1)]),s._v(" "),i("div",{staticClass:"name"},[s._v(s._s(s.label(e)))]),s._v(" "),i("div",{staticClass:"count-wrapper"},[i("div",{staticClass:"count"},[s._v(s._s(s.timelineSubs(e).length))])])]),s._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"subs"},s._l(s.timelineSubs(e),function(e,t){return i("div",{staticClass:"sub",style:"left:"+100*e.startprop+"%; width:"+100*(e.endprop-e.startprop)+"%;"},[i("div",{staticClass:"sub-handle sub-handle-left",on:{mousedown:function(t){s.initResize(e,"left")}}}),s._v(" "),i("div",{staticClass:"sub-index"},[s._v(s._s(s.subs.indexOf(e)+1))]),s._v(" "),i("div",{staticClass:"sub-handle sub-handle-right",on:{mousedown:function(t){s.initResize(e,"right")}}})])}))])])})),s._v(" "),i("div",{staticClass:"subtitler-editor-progress"},[""!=s.currentTime.text?i("div",{staticClass:"bar",style:"width:"+100*s.currentTime.prop+"%;"},[i("div",{staticClass:"handle",on:{mousedown:s.onHandleMouseDown}}),s._v(" "),i("div",{staticClass:"current-time"},[s._v(s._s(s.currentTime.text))])]):s._e()]),s._v(" "),i("div",{staticClass:"subtitler-editor-range"},[s.startExists?i("div",{staticClass:"start",style:"left:"+100*s.start.prop+"%;"},[i("div",{staticClass:"start-time"},[s._v(s._s(s.start.text))])]):s._e(),s._v(" "),s.endExists?i("div",{staticClass:"end",style:"left:"+100*s.end.prop+"%;"},[i("div",{staticClass:"end-time"},[s._v(s._s(s.end.text))])]):s._e()])]):s._e()])},e.staticRenderFns=[]},{1:1,2:2,3:3,4:4,5:5}],7:[function(t,e,s){!function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default={data:function(){return{processing:!1,hasError:!1,success:!1,icon:{type:"refresh",back:"theme-process"}}},props:{vttLength:Boolean,src:String,uri:String},computed:{text:function(){return this.hasError?this.$t("subtitler.vttbuilder.error"):this.success?this.vttLength?this.$t("subtitler.vttbuilder.updated"):this.$t("subtitler.vttbuilder.created"):this.processing?this.$t("subtitler.vttbuilder.processing"):this.vttLength?this.$t("subtitler.vttbuilder.update"):this.$t("subtitler.vttbuilder.create")}},methods:{generateVttFiles:function(){var e=this;this.processing=!0,this.$api.post("subtitler/generate-vtt-files",{uri:this.uri,src:this.src}).then(function(t){"success"==t.status?e.showSuccessMessage():e.showErrorMessage()}).catch(function(t){e.showErrorMessage()})},showErrorMessage:function(){this.processing=!1,this.hasError=!0;var t=this;setTimeout(function(){t.hasError=!1},3500)},showSuccessMessage:function(){this.processing=!1,this.success=!0;var t=this;setTimeout(function(){t.success=!1},3500)}}}}(),e.exports.__esModule&&(e.exports=e.exports.default);var i="function"==typeof e.exports?e.exports.options:e.exports;i.render=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-field",t._b({},"k-field",t.$attrs,!1),[s("div",{class:["tracksbuilder-button",{error:t.hasError},{processing:t.processing},{success:t.success}],on:{click:t.generateVttFiles}},[s("span",{staticClass:"icon"},[s("svg",{attrs:{viewBox:"0 0 16 16"}},[s("use",{attrs:{"xlink:href":"#icon-refresh"}})])]),t._v(" "),s("span",{staticClass:"text"},[s("em",[t._v(t._s(t.text))])])])])},i.staticRenderFns=[]},{}],8:[function(t,e,s){"use strict";var i=n(t(6)),r=n(t(7));function n(t){return t&&t.__esModule?t:{default:t}}panel.plugin("sylvainjule/subtitler",{sections:{subtitler:i.default},fields:{tracksbuilder:r.default}})},{6:6,7:7}]},{},[8]);
