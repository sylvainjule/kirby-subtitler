(function () {var a={};if(typeof a==="function"){a=a.options}Object.assign(a,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("svg",{attrs:{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 100 100"}},[_c("path",{attrs:{"fill":"#f8f8f8","d":"M88.76 25.43v66.91a7.66 7.66 0 0 1-7.67 7.66H18.91a7.66 7.66 0 0 1-7.66-7.66V7.66A7.66 7.66 0 0 1 18.91 0h45z"}}),_c("path",{attrs:{"fill":"#c1c1c1","d":"M88.76 25.43H71.58a7.66 7.66 0 0 1-7.66-7.66V0zM68.63 62.29v.26a7.13 7.13 0 1 1-3.7-6.25V40.21l-22.71 4.08V76a7.13 7.13 0 1 1-3.7-6.51V42.75A1.85 1.85 0 0 1 40 40.93l26.41-4.75h.33A1.85 1.85 0 0 1 68.63 38z"}})])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var b={};if(typeof b==="function"){b=b.options}Object.assign(b,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("svg",{attrs:{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 100 100"}},[_c("path",{attrs:{"d":"M87.73 42L21.46 1.42A9 9 0 0 0 7.83 9.48v81.15c0 7.31 7.66 11.72 13.63 8.05l66.27-40.56a9.53 9.53 0 0 0 0-16.11"}})])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var c={};if(typeof c==="function"){c=c.options}Object.assign(c,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("svg",{attrs:{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 100 100"}},[_c("path",{attrs:{"d":"M67.17 6a6 6 0 0 1 6-6H87a6 6 0 0 1 6 6v88a6 6 0 0 1-6 6H73.17a6 6 0 0 1-6-6zM7 94a6 6 0 0 0 6 6h13.83a6 6 0 0 0 6-6V6a6 6 0 0 0-6-6H13a6 6 0 0 0-6 6z"}})])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var d={};if(typeof d==="function"){d=d.options}Object.assign(d,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("svg",{attrs:{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 100 100"}},[_c("path",{attrs:{"d":"M98.35 22.5a5.5 5.5 0 0 0 0-7.86l-13-13a5.5 5.5 0 0 0-7.86 0L66.64 12.57l20.79 20.79zM0 79.21V100h20.79L80 40.83 59.17 20z"}})])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var e={};if(typeof e==="function"){e=e.options}Object.assign(e,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("svg",{staticClass:"arrow",attrs:{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 100 100"}},[_c("path",{attrs:{"d":"M99.53 52.45a6.26 6.26 0 0 0-1.35-6.8L54.49 2a6.24 6.24 0 0 0-8.83 8.83l33 33H6.39a6.24 6.24 0 1 0 0 12.48H78.7l-33 33a6.24 6.24 0 1 0 8.83 8.83l43.65-43.65a6.23 6.23 0 0 0 1.35-2.04z"}})])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var f={components:{AudioFile:a,PlayIcon:b,PauseIcon:c,EditIcon:d,ArrowIcon:e},data:function(){return{src:{id:"",type:"",url:""},resize:{isResizing:!1,handle:String,index:Number,max:Number,min:Number},loaded:!1,isPlaying:!1,active:null,subs:[],coords:{time:0,prop:0,text:""},currentTime:{time:0,prop:0,text:""},duration:{time:0,text:""},start:{time:0,prop:0,text:""},end:{time:0,prop:0,text:""}}},props:{storage:Object,theme:String,file:String,debug:Boolean,timelines:Object},computed:{isAudio:function(){return"audio"==this.src.type},isVideo:function(){return"video"==this.src.type},currentPlayer:function(){return this.isAudio?this.$refs.audioPlayer:this.$refs.videoPlayer},activeTimeline:function(){return null!=this.active},activeColor:function(){return!!this.activeTimeline&&this.active.color},fileExists:function(){return this.src.url&&this.src.type},startExists:function(){return this.start.time>0},endExists:function(){return this.end.time>0},disableStart:function(){return!this.startExists&&this.isOverlapping},disableEnd:function(){return this.isBeforeStart||this.isAfterNextSub||this.startIsOverlapping},isOverlapping:function(){var t=!1,e=!0,i=!1,r=void 0;try{for(var s,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var o=s.value;if(this.currentTime.prop>=o.startprop&&this.currentTime.prop<=o.endprop){t=!0;break}}}catch(a){i=!0,r=a}finally{try{e||null==n.return||n.return()}finally{if(i)throw r}}return t},startIsOverlapping:function(){var t=!1,e=!0,i=!1,r=void 0;try{for(var s,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var o=s.value;if(this.start.prop>=o.startprop&&this.start.prop<=o.endprop){t=!0;break}}}catch(a){i=!0,r=a}finally{try{e||null==n.return||n.return()}finally{if(i)throw r}}return t},isBeforeStart:function(){return this.currentTime.time<=this.start.time},isAfterNextSub:function(){var t=this.getNextSub(this.start.prop);return!!t&&this.currentTime.prop>=t.startprop},id:function(){return this.$store.state.form.current},pageValues:function(){return this.$store.getters["form/values"](this.id)}},watch:{pageValues:{immediate:!0,handler:function(){this.updateValues()}}},created:function(){var t=this;this.load().then(function(e){t.theme=e.theme,t.debug=e.debug,t.storage=e.storage,t.timelines=e.timelines,t.storage=e.storage,t.lang=e.lang,e.file&&(t.src.url=e.file.url,t.src.type=e.file.type)}),document.addEventListener("mouseup",this.stopResizing)},destroyed:function(){document.removeEventListener("mouseup",this.stopResizing)},methods:{init:function(){this.currentPlayer.addEventListener("timeupdate",this.timeUpdate),this.currentPlayer.addEventListener("loadeddata",this.loadedData),this.loaded=!0},loadedData:function(){this.currentPlayer.readyState>=2&&(this.setDuration(),this.syncCurrentTime(0))},timeUpdate:function(t){var e=this.currentPlayer.currentTime;!this.loaded&&e>0&&(this.loaded=!0),this.syncCurrentTime(e),e==this.duration.time&&this.isPlaying&&this.playPause()},playPause:function(){var t=this.currentPlayer;0==this.duration.time&&this.setDuration(),this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},updateCoords:function(t){var e=this.$refs.timeline;if(!e)return!1;var i=e.getBoundingClientRect(),r=e.clientWidth,s=(t.clientX-i.left)/r;s=Math.max(0,Math.min(1,s.toFixed(4))),this.coords.prop=s,this.coords.time=s*this.duration.time,this.coords.text=this.formatTime(this.coords.time),this.resize.isResizing&&this.resizeSub(t)},initResize:function(t,e){if(!this.active)return!1;if(this.resize.index=this.subs.indexOf(t),this.resize.isResizing=!0,this.resize.handle=e,"left"==e){var i=this.getPrevSub(parseFloat(t.startprop));this.resize.min=i?parseFloat(i.endprop)+1e-4:0,this.resize.max=parseFloat(t.endprop)-1e-4}else if("right"==e){var r=this.getNextSub(parseFloat(t.startprop));this.resize.min=parseFloat(t.startprop)+1e-4,this.resize.max=r?parseFloat(r.startprop)-1e-4:1}},resizeSub:function(t){var e=this.subs[this.resize.index];if("left"==this.resize.handle){var i=Math.min(this.resize.max,Math.max(this.resize.min,this.coords.prop));e.startprop=i,e.start=i*this.duration.time}if("right"==this.resize.handle){var r=Math.min(this.resize.max,Math.max(this.resize.min,this.coords.prop));e.endprop=r,e.end=r*this.duration.time}},stopResizing:function(t){if(!this.resize.isResizing)return!1;this.updateStructure(),this.resize.isResizing=!1,this.resize.handle=String,this.resize.index=Number,this.resize.max=Number,this.resize.min=Number},onHandleMouseDown:function(t){document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp)},onDocumentMouseUp:function(t){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove),this.syncProgress(t)},onDocumentMouseMove:function(t){this.syncProgress(t)},syncProgress:function(t){this.currentTime.prop=this.coords.prop.toFixed(4),this.currentTime.time=this.coords.prop*this.duration.time,this.currentTime.text=this.formatTime(this.coords.time),this.currentPlayer.currentTime=this.currentTime.time},setStart:function(){this.startExists?(this.resetStart(),this.resetEnd()):(this.start.prop=this.currentTime.prop,this.start.text=this.currentTime.text,this.start.time=this.currentTime.time)},setEnd:function(){this.end.prop=this.currentTime.prop,this.end.text=this.currentTime.text,this.end.time=this.currentTime.time;var t={start:this.start.time,startprop:this.start.prop,end:this.end.time,endprop:this.end.prop,timeline:this.active.id},e=this.getNewIndex();this.subs.splice(e,0,t),this.updateStructure(),this.resetStart(),this.resetEnd()},getNextSub:function(t){return this.timelineSubs(this.active).find(function(e){return e.startprop>t})},getPrevSub:function(t){return this.timelineSubs(this.active).splice(0).reverse().find(function(e){return t>e.endprop})},getNewIndex:function(){var t=this;if(!this.subs.length)return 0;if(this.timelineSubs(this.active).length){var e=this.getNextSub(this.start.prop);if(e)return this.subs.indexOf(e);var i=this.getPrevSub(this.start.prop);return this.subs.indexOf(i)+1}if(0==this.timelines.indexOf(this.active))return 0;var r=this.timelines.slice(this.timelines.indexOf(this.active)+1);if(r){var s=r.filter(function(e){return t.timelineSubs(e).length});if(s.length){var n=s[0],o=this.timelineSubs(n)[0];return this.subs.indexOf(o)}return this.subs.length}return this.subs.length},resetStart:function(){this.start.prop=0,this.start.text=0,this.start.time=0},resetEnd:function(){this.end.prop=0,this.end.text=0,this.end.time=0},setDuration:function(){var t=this.currentPlayer;this.duration.time=t.duration,this.duration.text=this.formatTime(t.duration)},syncCurrentTime:function(t){this.currentTime.time=t,this.currentTime.prop=(t/this.duration.time).toFixed(4),this.currentTime.text=this.formatTime(t)},setActive:function(t){this.active==t?(this.active=null,this.resetStart(),this.resetEnd()):this.active=t},timelineSubs:function(t){return this.subs.filter(function(e){return e.timeline==t.id})},formatTime:function(t){var e=Math.floor(t);return(e-(e%=60))/60+(9<e?"'":"'0")+e},updateValues:function(){for(var t in this.pageValues)if(Object.values(this.storage).includes(t)){var e=this.pageValues[t];this.setValue(t,e)}},setValue:function(t,e){var i=this;try{for(var r in this.storage)if(this.storage[r]===t)switch(r){case"src":this.loaded=!1,Array.isArray(e)&&e.length?this.src={id:e[0].id,url:e[0].url,type:e[0].type}:this.src={id:"",url:"",type:""};break;case"subs":if(!Array.isArray(e)){console.warn("could not adapt field to markers datapoint, not an array: ",e);break}this.subs=e;break;default:this[r]=e;}this.src.type&&!this.loaded&&this.$nextTick(function(){i.init()})}catch(s){console.warn(s)}},updateStructure:function(){this.storage.subs&&this.$store.dispatch("form/update",[this.id,this.storage.subs,this.subs])},isObject:function(t){return t===Object(t)},label:function(t){return this.isObject(t.label)?t.label[this.lang]:t.label}}};if(typeof f==="function"){f=f.options}Object.assign(f,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{staticClass:"subtitler",attrs:{"data-theme":_vm.theme,"data-color":_vm.activeColor},on:{"mousemove":_vm.updateCoords}},[_c("div",{staticClass:"subtitler-background"}),_vm._v(" "),!_vm.fileExists?_c("div",{staticClass:"subtitler-placeholder"},[_c("div",{staticClass:"subtitler-placeholder-ctn"},[_vm._v(" Please select a file ")])]):_vm._e(),_vm._v(" "),_vm.debug&&_vm.fileExists?_c("div",{staticClass:"subtitler-toolbar"},[_c("div",{staticClass:"subtitler-toolbar-debug"},[_c("div",{staticClass:"coord prop"},[_vm._v(_vm._s(_vm.coords.prop))]),_vm._v(" "),_c("div",{staticClass:"coord time"},[_vm._v(_vm._s(_vm.coords.time))]),_vm._v(" "),_c("div",{staticClass:"coord text"},[_vm._v(_vm._s(_vm.coords.text))])])]):_vm._e(),_vm._v(" "),_vm.fileExists?_c("div",{class:["subtitler-file",{"debug":_vm.debug}]},[_vm.isVideo?_c("div",{staticClass:"subtitler-video"},[_c("div",{staticClass:"subtitler-video-ctn"},[_c("video",{ref:"videoPlayer"},[_c("source",{attrs:{"src":_vm.src.url}})])])]):_vm._e(),_vm._v(" "),_vm.isAudio?_c("div",{staticClass:"subtitler-audio"},[_c("div",{staticClass:"audio-icon"},[_c("audio-file")],1),_vm._v(" "),_c("audio",{ref:"audioPlayer"},[_c("source",{attrs:{"src":_vm.src.url}})])]):_vm._e()]):_vm._e(),_vm._v(" "),_vm.fileExists?_c("div",{staticClass:"subtitler-editor"},[_c("div",{staticClass:"subtitler-editor-firstline"},[_c("div",{staticClass:"left"},[_c("button",{staticClass:"play",on:{"click":_vm.playPause}},[!_vm.isPlaying?_c("play-icon"):_vm._e(),_vm._v(" "),_vm.isPlaying?_c("pause-icon"):_vm._e()],1),_vm._v(" "),_vm.activeTimeline?_c("div",{staticClass:"range-buttons"},[_c("button",{class:["range-button start",{disabled:_vm.disableStart},{active:_vm.startExists}],on:{"click":_vm.setStart}},[_vm._v("{")]),_vm._v(" "),_vm.startExists?_c("arrow-icon"):_vm._e(),_vm._v(" "),_vm.startExists?_c("button",{staticClass:"range-button end",class:["range-button end",{disabled:_vm.disableEnd}],on:{"click":_vm.setEnd}},[_vm._v("}")]):_vm._e()],1):_vm._e()]),_vm._v(" "),_c("div",{ref:"timeline",staticClass:"right"},[_c("div",{staticClass:"duration"},[_vm._v(_vm._s(_vm.duration.text))])])]),_vm._v(" "),_c("div",{staticClass:"subtitler-editor-timelines"},_vm._l(_vm.timelines,function(timeline,index){return _c("div",{class:["timeline",{"active":timeline==_vm.active},{"inactive":_vm.activeTimeline&&timeline!=_vm.active}],attrs:{"data-theme":timeline.color}},[_c("div",{staticClass:"left"},[_c("div",{staticClass:"tick-wrapper"},[_c("div",{staticClass:"tick",on:{"click":function($event){return _vm.setActive(timeline)}}},[_c("edit-icon")],1)]),_vm._v(" "),_c("div",{staticClass:"name"},[_vm._v(_vm._s(_vm.label(timeline)))]),_vm._v(" "),_c("div",{staticClass:"count-wrapper"},[_c("div",{staticClass:"count"},[_vm._v(_vm._s(_vm.timelineSubs(timeline).length))])])]),_vm._v(" "),_c("div",{staticClass:"right"},[_c("div",{staticClass:"subs"},_vm._l(_vm.timelineSubs(timeline),function(sub,index){return _c("div",{staticClass:"sub",style:"left:"+sub.startprop*100+"%; width:"+(sub.endprop-sub.startprop)*100+"%;"},[_c("div",{staticClass:"sub-handle sub-handle-left",on:{"mousedown":function($event){return _vm.initResize(sub,"left")}}}),_vm._v(" "),_c("div",{staticClass:"sub-index"},[_vm._v(_vm._s(_vm.subs.indexOf(sub)+1))]),_vm._v(" "),_c("div",{staticClass:"sub-handle sub-handle-right",on:{"mousedown":function($event){return _vm.initResize(sub,"right")}}})])}),0)])])}),0),_vm._v(" "),_c("div",{staticClass:"subtitler-editor-progress"},[_vm.currentTime.text!=""?_c("div",{staticClass:"bar",style:"width:"+_vm.currentTime.prop*100+"%;"},[_c("div",{staticClass:"handle",on:{"mousedown":_vm.onHandleMouseDown}}),_vm._v(" "),_c("div",{staticClass:"current-time"},[_vm._v(_vm._s(_vm.currentTime.text))])]):_vm._e()]),_vm._v(" "),_c("div",{staticClass:"subtitler-editor-range"},[_vm.startExists?_c("div",{staticClass:"start",style:"left:"+_vm.start.prop*100+"%;"},[_c("div",{staticClass:"start-time"},[_vm._v(_vm._s(_vm.start.text))])]):_vm._e(),_vm._v(" "),_vm.endExists?_c("div",{staticClass:"end",style:"left:"+_vm.end.prop*100+"%;"},[_c("div",{staticClass:"end-time"},[_vm._v(_vm._s(_vm.end.text))])]):_vm._e()])]):_vm._e()])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var g={data:function(){return{processing:!1,hasError:!1,success:!1,icon:{type:"refresh",back:"theme-process"}}},props:{vttLength:Boolean,src:String,uri:String},computed:{text:function(){return this.hasError?this.$t("subtitler.vttbuilder.error"):this.success?this.vttLength?this.$t("subtitler.vttbuilder.updated"):this.$t("subtitler.vttbuilder.created"):this.processing?this.$t("subtitler.vttbuilder.processing"):this.vttLength?this.$t("subtitler.vttbuilder.update"):this.$t("subtitler.vttbuilder.create")}},methods:{generateVttFiles:function(){var t=this;this.processing=!0,this.$api.post("subtitler/generate-vtt-files",{uri:this.uri,src:this.src}).then(function(s){"success"==s.status?t.showSuccessMessage():t.showErrorMessage()}).catch(function(s){t.showErrorMessage()})},showErrorMessage:function(){this.processing=!1,this.hasError=!0;var t=this;setTimeout(function(){t.hasError=!1},3500)},showSuccessMessage:function(){this.processing=!1,this.success=!0;var t=this;setTimeout(function(){t.success=!1},3500)}}};if(typeof g==="function"){g=g.options}Object.assign(g,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("k-field",_vm._b({},"k-field",_vm.$attrs,false),[_c("div",{class:["tracksbuilder-button",{error:_vm.hasError},{processing:_vm.processing},{success:_vm.success}],on:{"click":_vm.generateVttFiles}},[_c("span",{staticClass:"icon"},[_c("svg",{attrs:{"viewBox":"0 0 16 16"}},[_c("use",{attrs:{"href":"#icon-refresh"}})])]),_vm._v(" "),_c("span",{staticClass:"text"},[_c("em",[_vm._v(_vm._s(_vm.text))])])])])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());panel.plugin("sylvainjule/subtitler",{sections:{subtitler:f},fields:{tracksbuilder:g}});})();